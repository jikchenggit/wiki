---
title: 存储规划
description: 存储规划
published: true
date: 2021-08-23T03:43:21.035Z
tags: 存储规划
editor: markdown
dateCreated: 2020-08-16T14:48:48.213Z
---

# 存储规划总览
要估计greenplum 数据库系统可以容纳多少数据,可以使用这些度量为指导.当然还要额外的空间存放备份文件和数据加载文件. 


# 计算可用磁盘容量

要计算一个greenplum 数据库系统可以容纳多少数据,必须计算每个segment 主机可用的磁盘数量.从每个段主机的可用磁盘容量,和段主机数量.

```
disk_size * number_of_disks
```
考虑文件系统格式化开销(大约10%) 和使用的RAID 级别.例如,使用RAID-10 ,计算公式为:
```
(raw_capacity * 0.9) / 2 = formatted_disk_space
```
为了获得最佳性能,不要完全使用完磁盘容量,而是在70% 或者更低界限值.因此,考虑这一点,计算可用磁盘空间如下:
```bash
formatted_disk_space * 0.7 = usable_disk_space
```
如果系统中有一个单独的磁盘系统,那么可以使用这个磁盘作为临时文件和事务文件.这样的话可以提高性能. 

一旦格式化了RAID 磁盘阵列,将会计算需要多少存储是实际用户数据(U),如果使用greenplum 镜像段冗余的,需要的空间为(2 * U) .greenplum 数据库 还需要一些空间被保留做为活跃的工作区域.工作区域应该是用户数据大小的三分之一(工作空间=U/3)

```bash
With mirrors: (2 * U) + U/3 = usable_disk_space

Without mirrors: U + U/3 = usable_disk_space
```
临时文件空间和用户数据空间的指导原则:
假定一个典型的分析工作负载.高并发工作负载或具有大量临时空间的查询工作可以从保留更多的空间提高性能.此外可以通过指定临时空间和用户空间驻留在不同的表空间来相互隔离. 

- [性能管理](/zh/greenplum/管理/性能管理) 获取更多信息.
- [创建和管理表空间](/zh/greenplum/管理/创建和管理表空间) 获取更多信息.
- [性能监控](/zh/greenplum/管理/性能监控) 获取更多信息.

# 计算用户数据大小

与所有数据库一样,一旦原始数据被加载到数据库中,它的大小会稍微大些.平均而言,原始数据加载到数据库后, 磁盘上的原始数据大约1.4 呗, 根据使用的数据类型,表存储类型,数据库内压缩等等,原始数据可能会更大或更小 

- 页面开销-- 当数据加载到greenplum 数据库中是, 被划分为每页32KB 的页面.每个页面都有20个字节的页面损耗 

- 行开销-- 在一个常规的`heap` 存储表中,每一行都有24 字节的行开销.一个`附加优化`存储表只有4 个字节的行开销.

- 属性开销-- 对于数据值本身,与每个属性值关联的大小取决于所选的数据类型.作为一般规则,希望使用尽可能小的数据类型来存储数据.

- 索引-- 在greenplum 数据库中,索引像表数据一样分布在整个段主机上.greenplum 数据库中默认索引类B-tree,由于索引大小取决于索引中唯一值的数量和要插入的数据,所以不可能精确计算索引的打大小,可以使用以下公式粗略估计索引的大小. 

```
B-tree: unique_values * (data_type_size + 24 bytes)

Bitmap: (unique_values * number_of_rows * 1 bit * compression_ratio / 8) + (unique_values * 32)
```
# 计算元数据和日志空间的需求
在每个段主机上,还需要为greenplum 数据库日志文件和元数据预留空间:

- 系统元数据-- 对于在主机运行的每个greenplum 数据库段实例(primayr 或 镜像段) 或master 实例,系统目录和元数据大约20MB.

- 预写日志-- 对于每个主机(primayr 或 镜像段)或master 实例.为预写日志(WAL) 分配空间.WAL 被划分为每个64MB 段文件.WAL 文件最多为:
```
2 * checkpoint_segments + 1
```
可以估计WAL 空间需求.Greenplum 数据库实例默认checkpoint_segment 8 ,意味着每个段主机或主实例分配1088 MB WAL 空间. 

- greenplum 数据库日志文件-- 每个段实例和主实例都会生成数据库日志文件,这些文件会随着时间的推移而增长.应该为这些日志文件分配足够的空间. 并使用某种日志工具确保日志文件不会增长的太大. 

- 命令中心数据 -- 命令中心使用的数据收集器和greenplum 数据库实例运行在同一组主机上. 代理程序收集历史数据存储在greenplum 数据库系统中他自己的中心数据库(名为gpperfmon) 中.


