---
title: 系统扩展概述
description: 系统扩展概述
published: true
date: 2021-08-23T03:49:56.697Z
tags: 系统扩展概述
editor: markdown
dateCreated: 2020-08-27T04:15:28.989Z
---

# 系统扩展概述
您可以执行Greenplum数据库扩展来添加段实例和段主机，而停机时间最短。通常，向Greenplum集群添加节点可以实现性能和存储容量的线性扩展。

数据仓库通常会随着时间而增长，通常以连续的速度增长，因为会收集更多的数据，并且现有数据的保留期也会增加。有时，有必要增加数据库容量，以便将不同的数据仓库合并到单个数据库中。数据仓库可能还需要额外的计算能力(CPU)来适应添加的分析项目。在最初指定系统时，为增长提供容量是好的，但即使预期增长速度很高，在需要之前对容量进行投资通常也是不明智的。因此，数据库扩展是一个需要定期执行的项目。

当你扩展你的数据库，你应该期望以下品质:

- 可伸缩的容量和性能。当您向Greenplum数据库添加资源时，容量和性能与最初使用添加的资源实现系统时相同。
- 扩展期间不间断服务。常规的工作负载(计划的和特别的)不会被中断。

- 事务的一致性。

- 容错。在扩展期间，标准容错机制(如段镜像)保持活跃、一致和有效。

- 复制和灾难恢复。任何现有的复制机制在扩展期间继续发挥作用。在发生故障或灾难性事件时所需的恢复机制仍然有效。

- 透明的过程。扩展过程使用了标准的Greenplum数据库机制，因此管理员可以诊断和排除任何问题。

- 可配置的过程。扩展可以是一个长时间运行的过程，但是它可以适合正在进行的操作的时间表。扩展模式的表允许管理员按表的重分发顺序排列优先级，并且可以暂停和恢复扩展活动。

与扩展数据库本身相比，扩展项目的规划和物理方面占了更大的比重。它将需要一个多学科的团队来计划和执行项目。对于内部安装，必须为新服务器获取和准备空间。必须指定、获取、安装、布线、配置和测试服务器。对于云部署，也应该制定类似的计划。[规划新硬件平台]()描述了部署新硬件时的一般考虑事项。

在提供新的硬件平台并设置其网络之后，配置操作系统并使用Greenplum实用程序运行性能测试。Greenplum数据库软件发行版包括一些实用工具，它们有助于在开始扩展的软件阶段之前对新服务器进行测试和老化。有关为Greenplum数据库准备新主机的步骤，请参阅[准备和添加主机]()。

一旦安装和测试了新服务器，Greenplum数据库扩展过程的软件阶段就开始了。软件阶段被设计为破坏性最小、事务一致、可靠和灵活

扩展过程的软件阶段的第一步是准备Greenplum数据库系统:添加新的段主机和初始化新的段实例。此阶段可以安排在低活动期间发生，以避免中断正在进行的业务操作。在初始化过程中，执行以下任务:

- 安装了Greenplum数据库软件。
- 在新的段主机上的新段实例中创建数据库和数据库对象。
- gpexpand模式在postgres数据库中创建。您可以使用模式中的表和视图来监视和控制扩展过程。
 系统更新后，新段主机上的新段实例就可用了。
- 新的段立即可用，并参与新的查询和数据加载。然而，现有的数据是扭曲的。它集中于原来的部分，必须在新的主要部分总数中重新分配。

- 由于一些表数据是倾斜的，因此可能需要更多的数据移动操作，因此一些查询的效率可能会较低。

软件阶段的最后一步是重新分发表数据。使用gpexpand模式中的扩展控制表作为指导，可以重新分发表。为每个表:

- gpexand实用程序根据分发策略在所有新老服务器之间重新分发表数据。

- 扩展控制表中更新表的状态

- 在数据重新分发之后，查询优化器在数据不倾斜的情况下创建更有效的执行计划。

当所有表都被重新分发时，扩展就完成了。

> 重要提示:gprestore实用程序不能恢复gpbackup实用程序在扩展之前所做的备份，因此在系统扩展完成后立即备份数据库。

重新分发表数据是一个长时间运行的过程，它会创建大量的网络和磁盘活动。重新分发一些非常大的数据库可能需要几天的时间。为了尽量减少增加的活动对业务操作的影响，系统管理员可以临时暂停和恢复扩展活动，或者按照预先确定的计划。可以对数据集进行优先排序，以便关键应用程序首先从扩展中获益。

在一个典型的操作中，在整个扩展过程中使用不同的选项运行gpexpand实用程序四次。

1. 要创建一个扩展输入文件:

```
gpexpand -f hosts_file
```
2. 要初始化段并创建扩展模式:
```
gpexpand -i input_file
```

gpexpand创建一个数据目录，从新段上的所有现有数据库复制用户表，并在扩展模式中捕获每个表的元数据，以便进行状态跟踪。在这个过程完成后，展开操作被提交并且不可撤销。
3. 重分发表数据:
```
gpexpand -d duration
```
在初始化期间，gpexpand添加并初始化新的段实例。要完成系统扩展，您必须运行gpexpand来跨新添加的段实例重新分发数据表。根据系统的大小和规模，可以在低使用时间内在单个会话中完成重新分发，也可以在较长时间内将流程划分为多个批次。在重新分发期间，每个表或分区都不可用于读或写操作.随着每个表被跨新段重新分布，数据库性能应该不断提高，直到超过扩展前的性能水平。

在需要多个重分发会话的大型系统中，您可能需要运行多次gpexpand来完成扩展。gpexpand可以受益于显式的表重新分配排名;参见计划表重新分配。

用户可以在初始化期间访问Greenplum数据库，但在严重依赖表哈希分布的系统上，他们可能会体验到性能下降。正常的操作(如ETL作业、用户查询和报告)可以继续进行，但是用户可能会体验到较慢的响应时间。

4. 要删除扩展模式:

```
gpexpand -c
```
有关gpexpand实用程序和其他用于系统扩展的实用程序的信息，请参阅[Greenplum数据库实用程序指南]()。


