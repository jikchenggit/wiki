---
title: sed命令
description: sed命令
published: true
date: 2021-08-23T03:35:03.668Z
tags: sed
editor: markdown
dateCreated: 2020-07-17T08:02:19.151Z
---

# **sed编辑器快速适用**

sed编辑器可以基于命令来操作数据流中的数据，这些命令要么从命令行中输入，要么保存在命令文本文件中。它每次从输入中读取一行数据，并用提供的编辑器命令匹配该数据，按命令中指定的操作修改数据，然后将生成的新数据输出到`STDOUT`。

## **B.1.1　启动sed编辑器**

`sed`命令的格式如下：

```
sed options script file


```

*`options`*参数允许你定制`sed`命令的行为，可包含表B-1中所列的选项。

**表 B-1　`sed`命令选项**

| 选项 | 描述 |
| --- | --- |
| `-e *script*` | 将*`script`*中指定的命令添加到处理输入时运行的命令中 |
| `-f *file*` | 将*`file`*文件中指定的命令添加到处理输入时运行的命令中 |
| `-n` | 不要为每条命令产生输出，但会等待打印命令 |

*`script`*参数指定了作用在数据流上的单条命令。如果需要不止一条命令，要么用`-e`选项在命令行上指定它们，要么用`-f`选项在一个单独文件中指定它们。

## **B.1.2　sed命令**

sed编辑器脚本含有sed针对输入流中的每行数据执行的命令。本节将会介绍一些较常见的sed命令。

**1\. 替换**

`s`命令会替换输入流中的文本。`s`命令的格式如下。

```
s/pattern/replacement/flags


```

其中*`pattern`*是要被替换的文本，*`replacement`*是`sed`要插到数据流中的新文本。

*`flags`*参数控制如何进行替换。有4种类型的替换标记可用。

- 一个数字，表明该模式出现的第几处应该被替换。
    
- `g`：表明所有该文本出现的地方都应该被替换。
    
- `p`：表明原来行中的内容应该被打印出来。
    
- `w *file*`：表明替换的结果应该写入到文件*`file`*中。
    

在第一类替换中，你可以指定sed编辑器应该替换第几处匹配模式的地方。举个例子，你可以用数字2来只替换该模式第二次出现的地方。

**2\. 寻址**

默认情况下，你在sed编辑器中使用的命令会作用在文本数据的所有行上。如果你想让命令只作用在指定行或一组行上，就必须使用**行寻址**（line addressing）。

在sed编辑器中，有两种形式的行寻址：

- 行区间（数字形式）
    
- 可以过滤出特定行的文本模式
    

两种形式使用相同的格式来指定地址。

```
[address]command


```

当使用数字形式的行寻址时，我们通过行在文本流中的位置来引用行。sed编辑器会给数据流中的第一行分配行号1，然后对接下来的每行依次顺序增加。

```
$ sed '2,3s/dog/cat/' data1


```

另一个限制命令作用在哪些行上的方法有点复杂。sed编辑器允许你指定一个文本模式，它会用这个文本模式来为命令过滤出行，格式如下。

```
/pattern/command


```

必须用斜线来将你指定的*`pattern`*包围起来。sed编辑器会将*`command`*只作用在包含你指定的文本模式的行上。

```
$ sed '/rich/s/bash/csh/' /etc/passwd


```

这个过滤器能够找到含有文本`rich`的行，然后用`csh`来替换文本`bash`。

也可以为某个特定地址将多条命令放在一起。

```
address {
     command1
     command2
     command3 }


```

sed编辑器会将你指定的每条命令作用在匹配指定地址的行上。sed编辑器会处理和地址行对应的每条命令。

```
$ sed '2{
> s/fox/elephant/
> s/dog/cat/
> }' data1


```

sed编辑器将每一条替换命令都作用在数据文件的第二行上。

**3\. 删除行**

删除（`delete`）命令`d`与它的名字十分相配。它会删除所有与提供的地址模式匹配的文本行。使用删除命令时要小心，因为如果你忘记加地址模式，所有的行都会被从数据流中删掉。

```
$ sed 'd' data1


```

显然，删除命令跟指定的地址一起使用时才最有用。它允许你从数据流中删除特定的文本行，要么通过行号指定：

```
$ sed '3d' data6


```

要么通过特定的行区间指定：

```
$ sed '2,3d' data6


```

sed编辑器的模式匹配功能也适用于删除命令。

```
$ sed '/number 1/d' data6


```

只有匹配指定文本的行才会被从流中删掉。

**4\. 插入和附加文本**

如你所料，跟任何其他编辑器一样，sed编辑器允许你向数据流中插入和附加文本。这两个命令的区别有些模糊：

- 插入（`insert`）命令（`i`）在指定行前面添加一个新行；
    
- 附加（`append`）命令（`a`）在指定行后面添加一个新行。
    

这两条命令的格式很容易让人困惑：你不能在单个命令行上使用这两条命令。要插入或附加的行必须作为单独的一行出现，格式如下。

```
sed '[address]command\
new line'


```

*`new line`*中的文本按你指定的位置出现在sed编辑器的输出中。记住，当使用插入命令时，文本会出现在指定行之前。

```
$ echo "testing" | sed 'i\
> This is a test'
This is a test
testing
$


```

当使用追加命令时，文本会出现在指定行之后。

```
$ echo "testing" | sed 'a\
> This is a test'
testing
This is a test
$


```

这允许你在普通文本的末尾插入文本。

**5\. 修改行**

修改（`change`）命令允许你修改数据流中的整行文本。其格式跟插入和附加命令一样，你必须将新行与`sed`命令的其余部分分开。

```
$ sed '3c\
> This is a changed line of text.' data6


```

反斜线字符用来表明脚本中的新数据行。

**6\. 转换命令**

转换（`transform`）命令（`y`）是唯一一个作用在单个字符上的sed编辑器命令。转换命令使用如下格式。

```
[address]y/inchars/outchars/


```

转换命令对*`inchars`*和*`outchars`*执行一对一的映射。*`inchars`*中的第一个字符会转换为*`outchars`*中的第一个字符，*`inchars`*中的第二个字符会转换为*`outchars`*中的第二个字符，依此类推，直到超过了指定字符的长度。如果*`inchars`*和*`outchars`*长度不同，sed编辑器会报错。

**7\. 打印行**

类似于替换命令中的`p`标记，`p`命令会在sed编辑器的输出中打印一行。打印（`print`）命令最常见的用法是打印与指定文本模式匹配的文本行。

```
$ sed -n '/number 3/p' data6
This is line number 3.
$


```

打印命令允许你从输入流中过滤出特定的数据行。

**8\. 写入到文件**

`w`命令用来将文本行写入到文件中。`w`命令的格式为：

```
[address]w filename


```

*`filename`*可以用相对路径或绝对路径指定，但不管怎样，运行sed编辑器的人都必须有文件的写权限。*`address`*可以是任意类型的寻址方法，比如单行行号、文本模式、行号区间或多个文本模式。

这里有个例子，它只将数据流的前两行写入到文本文件。

```
$ sed '1,2w test' data6


```

输出文件test只含有输入流的前两行。

**9\. 从文件中读取**

你已经了解了如何使用`sed`命令向数据流中插入和附加文本。读取（`read`）命令（`r`）允许你插入单个文件中的数据。读取命令的格式为：

```
[address]r filename


```

其中*`filename`*参数使用相对路径或绝对路径的形式来指定含有数据的文件。读取命令不能使用地址区间，只能使用单个行号或文本模式地址。sed编辑器会将文件中的文本插入指定地址之后：

```
$ sed '3r data' data2


```

sed编辑器将data文件中的全部文本都插入了data2文件中第3行开始的地方。

# 命令参考手册
sed对文本的处理很强大，并且sed非常小，参数少，容易掌握，他的操作方式根awk有点像。sed按顺序逐行读取文件。然后，它执行为该行指定的所有操作，并在完成请求的修改之后的内容显示出来，也可以存放到文件中。完成了一行上的所有操作之后，它读取文件的下一行，然后重复该过程直到它完成该文件。在这里要注意一点，源文件（默认地）保持不被修改。sed 默认读取整个文件并对其中的每一行进行修改。说白了就是一行一行的操作。我用sed主要就是用里面的替换功能，真的很强大。下面以实例，详细的说一下，先从替换开始，最常用的。

sed -h
 -n, --quiet, --silent    取消自动打印模式空间
 -e 脚本, --expression=脚本   添加“脚本”到程序的运行列表
 -f 脚本文件, --file=脚本文件  添加“脚本文件”到程序的运行列表
 --follow-symlinks    直接修改文件时跟随软链接
 -i[扩展名], --in-place[=扩展名]    直接修改文件(如果指定扩展名就备份文件)
 -l N, --line-length=N   指定“l”命令的换行期望长度
 --posix  关闭所有 GNU 扩展
 -r, --regexp-extended  在脚本中使用扩展正则表达式
 -s, --separate  将输入文件视为各个独立的文件而不是一个长的连续输入
 -u, --unbuffered  从输入文件读取最少的数据，更频繁的刷新输出
 --help     打印帮助并退出
 --version  输出版本信息并退出
 -a ∶新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)～
 -c ∶取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！
 -d ∶删除，因为是删除啊，所以 d 后面通常不接任何咚咚；
 -i ∶插入， i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)；
 -p ∶列印，亦即将某个选择的资料印出。通常 p 会与参数 sed -n 一起运作～
 -s ∶取代，可以直接进行取代的工作哩！通常这个 s 的动作可以搭配正规表示法


sed命令
a\\ 在当前行下面插入文本。
i\\ 在当前行上面插入文本。
c\\ 把选定的行改为新的文本。
d 删除，删除选择的行。
D 删除模板块的第一行。
s 替换指定字符
h 拷贝模板块的内容到内存中的缓冲区。
H 追加模板块的内容到内存中的缓冲区。
g 获得内存缓冲区的内容，并替代当前模板块中的文本。
G 获得内存缓冲区的内容，并追加到当前模板块文本的后面。
l 列表不能打印字符的清单。
n 读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。
N 追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。
p 打印模板块的行。
P(大写) 打印模板块的第一行。
q 退出Sed。
b lable 分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。
r file 从file中读行。
t label if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
T label 错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
w file 写并追加模板块到file末尾。 
W file 写并追加模板块的第一行到file末尾。 
! 表示后面的命令对所有没有被选定的行发生作用。 
= 打印当前行号码。 
# 把注释扩展到下一个换行符以前。 


sed替换标记
g 表示行内全面替换。 
p 表示打印行。 
w 表示把行写入一个文件。 
x 表示互换模板块中的文本和缓冲区中的文本。 
y 表示把一个字符翻译为另外的字符（但是不用于正则表达式）
\\1 子串匹配标记
& 已匹配字符串标记

sed元字符集
^ 匹配行开始，如：/^sed/匹配所有以sed开头的行。
$ 匹配行结束，如：/sed$/匹配所有以sed结尾的行。
. 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。
* 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。
[] 匹配一个指定范围内的字符，如/[sS]ed/匹配sed和Sed。 
[^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。
\\(..\\) 匹配子串，保存匹配的字符，如s/\\(love\\)able/\\1rs，loveable被替换成lovers。
& 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。
\\< 匹配单词的开始，如:/\\\\> 匹配单词的结束，如/love\\>/匹配包含以love结尾的单词的行。
x\\{m\\} 重复字符x，m次，如：/0\\{5\\}/匹配包含5个0的行。
x\\{m,\\} 重复字符x，至少m次，如：/0\\{5,\\}/匹配至少有5个0的行。
x\\{m,n\\} 重复字符x，至少m次，不多于n次，如：/0\\{5,10\\}/匹配5~10个0的行。